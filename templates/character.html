<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ character.name }} - EchoSheet</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="main-header">
            <h1 class="title">üé≤ EchoSheet</h1>
            <a href="{{ url_for('index') }}" class="back-link">‚Üê Back to Characters</a>
        </header>

        <main class="main-content">
            <div class="character-sheet">
                <!-- Character Header -->
                <div class="character-header">
                    <div class="character-info">
                        <h2 class="character-name">{{ character.name }}</h2>
                        <div class="character-basics">
                            <span class="character-level">Level {{ character.level }}</span>
                            <span class="character-race">{{ character.race }}</span>
                            <span class="character-class">{{ character.char_class }}</span>
                            {% if character.background %}
                                <span class="character-background">{{ character.background }}</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="character-actions">
                        <a href="{{ url_for('chat_with_character', character_id=character.id) }}" class="btn btn-accent">
                            üí¨ Chat with {{ character.name }}
                        </a>
                        <button class="btn btn-success download-pdf-btn" 
                                data-character-id="{{ character.id }}" 
                                data-character-name="{{ character.name }}"
                                title="Download PDF">
                            üìÑ Download PDF
                        </button>
                        <button class="btn btn-danger delete-character-btn" 
                                data-character-id="{{ character.id }}" 
                                data-character-name="{{ character.name }}">
                            üóëÔ∏è Delete Character
                        </button>
                    </div>
                </div>

                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button class="tab-btn active" data-tab="overview">
                        üìä Overview
                    </button>
                    <button class="tab-btn" data-tab="character-info">
                        üë§ Character Info
                    </button>
                    <button class="tab-btn" data-tab="spells">
                        ‚ú® Spells
                    </button>
                    <button class="tab-btn" data-tab="combat">
                        ‚öîÔ∏è Combat
                    </button>
                    <button class="tab-btn" data-tab="inventory">
                        üéí Inventory
                    </button>

                </div>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Overview Tab -->
                    <div class="tab-pane active" id="overview-tab">
                        <div class="sheet-content">
                            <div class="sheet-main">
                                <!-- Attributes Section -->
                                <section class="attributes-section">
                                    <h3>üìä Core Attributes</h3>
                                    <div class="attributes-grid">
                                        {% for attr, value in character.attributes.items() %}
                                        <div class="attribute-card">
                                            <div class="attribute-name">{{ attr }}</div>
                                            <div class="attribute-value">{{ value }}</div>
                                            <div class="attribute-modifier">
                                                {% set modifier = character.get_attribute_modifier(attr) %}
                                                {% if modifier >= 0 %}+{% endif %}{{ modifier }}
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </section>

                                <!-- Skills Section -->
                                <section class="skills-section">
                                    <h3>üéØ Proficient Skills</h3>
                                    <div class="skills-grid">
                                        {% for skill in character.skills %}
                                        <div class="skill-item">
                                            <span class="skill-name">{{ skill }}</span>
                                            <span class="skill-bonus">
                                                {% set bonus = character.get_skill_bonus(skill) %}
                                                {% if bonus >= 0 %}+{% endif %}{{ bonus }}
                                            </span>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </section>

                                <!-- Feats Section -->
                                {% if character.feats %}
                                <section class="feats-section">
                                    <h3>üèÜ Feats & Abilities</h3>
                                    <div class="feats-grid">
                                        {% for feat in character.feats %}
                                        <div class="feat-item">{{ feat }}</div>
                                        {% endfor %}
                                    </div>
                                </section>
                                {% endif %}
                            </div>

                            <!-- Sidebar with Overview Recommendations -->
                            <div class="sheet-sidebar">
                                <section class="recommendations-section">
                                    <h3>üí° Character Development</h3>
                                    
                                    <!-- Subclass Recommendation -->
                                    <div class="recommendation-card">
                                        <h4>üé≠ Recommended Subclass</h4>
                                        <p class="recommendation-title">{{ recommendations.subclass.recommended }}</p>
                                        <p class="recommendation-reason">{{ recommendations.subclass.reason }}</p>
                                        <div class="recommendation-options">
                                            <strong>Other options:</strong>
                                            {% for subclass in recommendations.subclass.recommendations[:3] %}
                                                {% if subclass != recommendations.subclass.recommended %}
                                                <span class="option-tag">{{ subclass }}</span>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>

                                    <!-- Skill Recommendations -->
                                    {% if recommendations.skills.recommendations %}
                                    <div class="recommendation-card">
                                        <h4>üéØ Additional Skills</h4>
                                        <p class="recommendation-reason">{{ recommendations.skills.reason }}</p>
                                        <div class="recommendation-list">
                                            {% for skill in recommendations.skills.recommendations %}
                                            <span class="recommendation-item">{{ skill }}</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endif %}

                                    <!-- Feat Recommendation -->
                                    <div class="recommendation-card">
                                        <h4>üèÜ Recommended Feat</h4>
                                        <p class="recommendation-title">{{ recommendations.feats.recommended }}</p>
                                        <p class="recommendation-reason">{{ recommendations.feats.reason }}</p>
                                    </div>

                                    <!-- Next Level Planning -->
                                    <div class="recommendation-card">
                                        <h4>üìà Next Level ({{ recommendations.next_level.level }})</h4>
                                        <p><strong>Proficiency Bonus:</strong> +{{ recommendations.next_level.proficiency_bonus }}</p>
                                        {% if recommendations.next_level.suggestions %}
                                        <div class="level-suggestions">
                                            {% for suggestion in recommendations.next_level.suggestions %}
                                            <p class="suggestion-item">üí° {{ suggestion }}</p>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>

                    <!-- Character Info Tab -->
                    <div class="tab-pane" id="character-info-tab">
                        <div class="sheet-content">
                            <div class="sheet-main">
                                <!-- Basic Information Section -->
                                <section class="basic-info-section">
                                    <h3>üìã Basic Information</h3>
                                    <div class="basic-info-editor">
                                        <div class="basic-info-grid">
                                            <div class="info-item">
                                                <label>Alignment</label>
                                                <select id="alignment-select" class="info-input">
                                                    <option value="">Select alignment...</option>
                                                    <option value="Lawful Good" {{ 'selected' if character.alignment == 'Lawful Good' else '' }}>Lawful Good</option>
                                                    <option value="Neutral Good" {{ 'selected' if character.alignment == 'Neutral Good' else '' }}>Neutral Good</option>
                                                    <option value="Chaotic Good" {{ 'selected' if character.alignment == 'Chaotic Good' else '' }}>Chaotic Good</option>
                                                    <option value="Lawful Neutral" {{ 'selected' if character.alignment == 'Lawful Neutral' else '' }}>Lawful Neutral</option>
                                                    <option value="True Neutral" {{ 'selected' if character.alignment == 'True Neutral' else '' }}>True Neutral</option>
                                                    <option value="Chaotic Neutral" {{ 'selected' if character.alignment == 'Chaotic Neutral' else '' }}>Chaotic Neutral</option>
                                                    <option value="Lawful Evil" {{ 'selected' if character.alignment == 'Lawful Evil' else '' }}>Lawful Evil</option>
                                                    <option value="Neutral Evil" {{ 'selected' if character.alignment == 'Neutral Evil' else '' }}>Neutral Evil</option>
                                                    <option value="Chaotic Evil" {{ 'selected' if character.alignment == 'Chaotic Evil' else '' }}>Chaotic Evil</option>
                                                </select>
                                            </div>
                                            <div class="info-item">
                                                <label>Experience Points</label>
                                                <input type="number" id="experience-points" class="info-input" 
                                                       value="{{ character.experience_points }}" min="0">
                                            </div>
                                            <div class="info-item">
                                                <label>Current Level</label>
                                                <span class="info-display" id="character-level">{{ character.level }}</span>
                                            </div>
                                            <div class="info-item">
                                                <label>Experience to Next Level</label>
                                                <span class="info-display" id="experience-to-next-level">{{ character.get_experience_to_next_level() }} XP</span>
                                            </div>
                                            <div class="info-item">
                                                <label>Experience Progress</label>
                                                <div class="progress-bar">
                                                    <div class="progress-fill" id="experience-progress-fill" style="width: {{ character.get_experience_progress() }}%"></div>
                                                </div>
                                                <span class="info-display" id="experience-progress-text">{{ "%.1f"|format(character.get_experience_progress()) }}%</span>
                                            </div>
                                            <div class="info-item level-up-item" id="level-up-container" style="display: none;">
                                                <button id="level-up-btn" class="btn btn-warning">üéØ Level Up!</button>
                                            </div>
                                            
                                        </div>
                                        <button id="save-basic-info-btn" class="btn btn-success">üíæ Save Basic Info</button>
                                    </div>
                                </section>

                                <!-- Physical Characteristics Section -->
                                <section class="physical-section">
                                    <h3>üë§ Physical Characteristics</h3>
                                    <div class="physical-editor">
                                        <div class="physical-grid">
                                            <div class="info-item">
                                                <label>Age</label>
                                                <input type="text" id="age-input" class="info-input" 
                                                       value="{{ character.age }}" placeholder="e.g., 25 years old">
                                            </div>
                                            <div class="info-item">
                                                <label>Height</label>
                                                <input type="text" id="height-input" class="info-input" 
                                                       value="{{ character.height }}" placeholder="e.g., 5'8\"">
                                            </div>
                                            <div class="info-item">
                                                <label>Weight</label>
                                                <input type="text" id="weight-input" class="info-input" 
                                                       value="{{ character.weight }}" placeholder="e.g., 150 lbs">
                                            </div>
                                            <div class="info-item">
                                                <label>Eyes</label>
                                                <input type="text" id="eyes-input" class="info-input" 
                                                       value="{{ character.eyes }}" placeholder="e.g., Blue">
                                            </div>
                                            <div class="info-item">
                                                <label>Skin</label>
                                                <input type="text" id="skin-input" class="info-input" 
                                                       value="{{ character.skin }}" placeholder="e.g., Fair">
                                            </div>
                                            <div class="info-item">
                                                <label>Hair</label>
                                                <input type="text" id="hair-input" class="info-input" 
                                                       value="{{ character.hair }}" placeholder="e.g., Brown">
                                            </div>
                                        </div>
                                        <button id="save-physical-btn" class="btn btn-success">üíæ Save Physical Info</button>
                                    </div>
                                </section>

                                <!-- Personality Section -->
                                <section class="personality-section">
                                    <h3>üí≠ Personality & Background</h3>
                                    
                                    <!-- D&D 5e Standard Personality Traits -->
                                    <div class="personality-field">
                                        <label for="personality-traits">üé≠ Personality Traits</label>
                                        <textarea id="personality-traits" class="personality-textarea" 
                                                  placeholder="Describe your character's personality traits, mannerisms, and behavioral quirks..."
                                                  maxlength="200">{{ character.personality_traits }}</textarea>
                                        <div class="char-counter">
                                            <span id="personality-traits-count">{{ character.personality_traits|length }}</span>/200
                                        </div>
                                    </div>

                                    <div class="personality-field">
                                        <label for="ideals">üåü Ideals</label>
                                        <textarea id="ideals" class="personality-textarea" 
                                                  placeholder="What are your character's core beliefs, moral principles, and driving ideals?"
                                                  maxlength="200">{{ character.ideals }}</textarea>
                                        <div class="char-counter">
                                            <span id="ideals-count">{{ character.ideals|length }}</span>/200
                                        </div>
                                    </div>

                                    <div class="personality-field">
                                        <label for="bonds">üíù Bonds</label>
                                        <textarea id="bonds" class="personality-textarea" 
                                                  placeholder="What connections, relationships, or attachments are most important to your character?"
                                                  maxlength="200">{{ character.bonds }}</textarea>
                                        <div class="char-counter">
                                            <span id="bonds-count">{{ character.bonds|length }}</span>/200
                                        </div>
                                    </div>

                                    <!-- Extended Personality Fields -->
                                    <div class="personality-field">
                                        <label for="background-story">üìñ Background Story</label>
                                        <textarea id="background-story" class="personality-textarea" 
                                                  placeholder="Tell the story of your character's past, their origins, and what led them to adventure..."
                                                  maxlength="500">{{ character.background_story }}</textarea>
                                        <div class="char-counter">
                                            <span id="background-story-count">{{ character.background_story|length }}</span>/500
                                        </div>
                                    </div>

                                    <div class="personality-field">
                                        <label for="short-term-goals">üéØ Short-term Goals</label>
                                        <textarea id="short-term-goals" class="personality-textarea" 
                                                  placeholder="What immediate objectives or goals does your character want to achieve?"
                                                  maxlength="300">{{ character.short_term_goals }}</textarea>
                                        <div class="char-counter">
                                            <span id="short-term-goals-count">{{ character.short_term_goals|length }}</span>/300
                                        </div>
                                    </div>

                                    <div class="personality-field">
                                        <label for="long-term-goals">üåü Long-term Goals</label>
                                        <textarea id="long-term-goals" class="personality-textarea" 
                                                  placeholder="What are your character's ultimate aspirations and long-term objectives?"
                                                  maxlength="300">{{ character.long_term_goals }}</textarea>
                                        <div class="char-counter">
                                            <span id="long-term-goals-count">{{ character.long_term_goals|length }}</span>/300
                                        </div>
                                    </div>

                                    <div class="personality-field">
                                        <label for="personal-goals">üí´ Personal Goals</label>
                                        <textarea id="personal-goals" class="personality-textarea" 
                                                  placeholder="What personal desires, dreams, or private objectives does your character have?"
                                                  maxlength="300">{{ character.personal_goals }}</textarea>
                                        <div class="char-counter">
                                            <span id="personal-goals-count">{{ character.personal_goals|length }}</span>/300
                                        </div>
                                    </div>

                                    <!-- Personality Tags -->
                                    <div class="personality-field">
                                        <label for="personality-tags">üè∑Ô∏è Personality Tags</label>
                                        <div class="tags-input-container">
                                            <input type="text" id="personality-tags" class="personality-input" 
                                                   placeholder="Type personality traits and press Enter, Space, or Comma to add tags..."
                                                   value="{{ character.personality_tags|join(' ') if character.personality_tags else '' }}">
                                            <div class="tags-container" id="personality-tags-container">
                                                {% for tag in character.personality_tags %}
                                                <span class="tag" data-tag="{{ tag }}">
                                                    {{ tag }}
                                                    <button class="tag-remove" onclick="removeTag(this)">√ó</button>
                                                </span>
                                                {% endfor %}
                                            </div>
                                        </div>
                                        <div class="tags-help">
                                            üí° Add single-word personality traits like "brave", "curious", "loyal", "impulsive", etc.
                                        </div>
                                    </div>

                                    <!-- Flaws -->
                                    <div class="personality-field">
                                        <label for="flaws">üíî Flaws</label>
                                        <textarea id="flaws" class="personality-textarea" 
                                                  placeholder="What are your character's weaknesses, vices, or character flaws that make them more realistic?"
                                                  maxlength="300">{{ character.flaws }}</textarea>
                                        <div class="char-counter">
                                            <span id="flaws-count">{{ character.flaws|length }}</span>/300
                                        </div>
                                    </div>

                                    <!-- Save Personality Button -->
                                    <button id="save-personality-btn" class="btn btn-success">üíæ Save Personality</button>
                                </section>


                            </div>

                                            <!-- Sidebar with Character Info Tips -->
                <div class="sheet-sidebar">
                    <section class="recommendations-section">
                        <h3>üí° Character Development</h3>
                        
                        <div class="recommendation-card">
                            <h4>üìä Experience & Leveling</h4>
                            <div class="tips-list">
                                <p class="tip-item">üéØ Complete quests and defeat enemies to gain XP</p>
                                <p class="tip-item">üìà Each level brings new abilities and improvements</p>
                                <p class="tip-item">‚ö° Focus on your character's strengths</p>
                                <p class="tip-item">üîÑ Consider multiclassing for unique combinations</p>
                            </div>
                        </div>

                        <div class="recommendation-card">
                            <h4>üë§ Physical Description</h4>
                            <div class="tips-list">
                                <p class="tip-item">üé® Add unique physical traits to make your character memorable</p>
                                <p class="tip-item">üëÅÔ∏è Eye color can reflect personality or magical influence</p>
                                <p class="tip-item">üíá Hair style and color can show cultural background</p>
                                <p class="tip-item">üèÉ Physical characteristics can affect roleplay</p>
                            </div>
                        </div>

                        <div class="recommendation-card">
                            <h4>üí≠ Personality Development</h4>
                            <div class="tips-list">
                                <p class="tip-item">üé≠ Use personality traits to guide roleplay decisions</p>
                                <p class="tip-item">üåü Ideals should drive your character's major choices</p>
                                <p class="tip-item">üíù Bonds create emotional connections to the world</p>
                                <p class="tip-item">üéØ Goals give your character purpose and direction</p>
                                <p class="tip-item">üè∑Ô∏è Tags help quickly identify character quirks</p>
                                <p class="tip-item">üíî Flaws make characters more realistic and interesting</p>
                            </div>
                        </div>

                        <div class="recommendation-card">
                            <h4>‚ù§Ô∏è Hit Point Management</h4>
                            <div class="tips-list">
                                <p class="tip-item">üõ°Ô∏è Keep track of current HP during combat</p>
                                <p class="tip-item">üíä Use healing potions and spells when needed</p>
                                <p class="tip-item">‚ö° Temporary HP provides extra protection</p>
                                <p class="tip-item">üé≤ Hit dice can be used for healing during short rests</p>
                            </div>
                        </div>
                    </section>
                </div>
                        </div>
                    </div>

                    <!-- Spells Tab -->
                    <div class="tab-pane" id="spells-tab">
                        <div class="sheet-content">
                            <div class="sheet-main">
                                {% if character.cantrips or character.spells_known or character.spells %}
                                <section class="spells-section">
                                    <h3>‚ú® Spellcasting</h3>
                                    
                                    <!-- Spellcasting Summary -->
                                    <div class="spellcasting-summary">
                                        <div class="summary-item">
                                            <span class="summary-label">Spellcasting Ability:</span>
                                            <span class="summary-value">{{ character.get_spellcasting_ability() }}</span>
                                        </div>
                                        <div class="summary-item">
                                            <span class="summary-label">Spell Save DC:</span>
                                            <span class="summary-value">{{ character.get_spell_save_dc() }}</span>
                                        </div>
                                        <div class="summary-item">
                                            <span class="summary-label">Spell Attack Bonus:</span>
                                            <span class="summary-value">{{ character.get_spell_attack_bonus() }}</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Spell Slots -->
                                    <div class="spell-slots-section">
                                        <h4>üìñ Spell Slots</h4>
                                        <div class="spell-slots-grid">
                                            {% for level in range(1, 10) %}
                                                {% set slots = character.get_spell_slots(level) %}
                                                {% if slots > 0 %}
                                                <div class="spell-slot-item">
                                                    <span class="slot-level">{{ level }}{% if level == 1 %}st{% elif level == 2 %}nd{% elif level == 3 %}rd{% else %}th{% endif %}</span>
                                                    <span class="slot-count">{{ slots }}</span>
                                                </div>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    
                                    {% if cantrips_info %}
                                    <div class="cantrips-subsection">
                                        <h4>üîÆ Cantrips ({{ cantrips_info|length }})</h4>
                                        <div class="spells-grid">
                                            {% for spell in cantrips_info %}
                                            <div class="spell-card" data-spell-name="{{ spell.name }}" data-type="cantrip">
                                                <div class="spell-header">
                                                    <div class="spell-title">
                                                        <h5 class="spell-name">{{ spell.name }}</h5>
                                                        <span class="spell-school">{{ spell.school }}</span>
                                                    </div>
                                                    {% if spell.source %}
                                                    <div class="spell-header-right">
                                                        <div class="spell-source-badge {{ spell.source.lower() }}">{{ spell.source }}</div>
                                                        <button class="spell-info-btn" onclick="showSpellInfo('{{ spell.name }}')" title="View spell details">üìñ</button>
                                                    </div>
                                                    {% else %}
                                                    <button class="spell-info-btn" onclick="showSpellInfo('{{ spell.name }}')" title="View spell details">üìñ</button>
                                                    {% endif %}
                                                </div>
                                                <div class="spell-content">
                                                    <div class="spell-stat">
                                                        <span class="stat-label">Casting Time:</span>
                                                        <span class="stat-value">{{ spell.casting_time }}</span>
                                                    </div>
                                                    <div class="spell-stat">
                                                        <span class="stat-label">Range:</span>
                                                        <span class="stat-value">{{ spell.range }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endif %}
                                    
                                    {% if spells_info %}
                                    <div class="spells-subsection">
                                        <h4>üìö 1st Level Spells ({{ spells_info|length }})</h4>
                                        <div class="spells-grid">
                                            {% for spell in spells_info %}
                                            <div class="spell-card" data-spell-name="{{ spell.name }}" data-type="spell">
                                                <div class="spell-header">
                                                    <div class="spell-title">
                                                        <h5 class="spell-name">{{ spell.name }}</h5>
                                                        <span class="spell-school">{{ spell.school }}</span>
                                                    </div>
                                                    {% if spell.source %}
                                                    <div class="spell-header-right">
                                                        <div class="spell-source-badge {{ spell.source.lower() }}">{{ spell.source }}</div>
                                                        <button class="spell-info-btn" onclick="showSpellInfo('{{ spell.name }}')" title="View spell details">üìñ</button>
                                                    </div>
                                                    {% else %}
                                                    <button class="spell-info-btn" onclick="showSpellInfo('{{ spell.name }}')" title="View spell details">üìñ</button>
                                                    {% endif %}
                                                </div>
                                                <div class="spell-content">
                                                    <div class="spell-stat">
                                                        <span class="stat-label">Casting Time:</span>
                                                        <span class="stat-value">{{ spell.casting_time }}</span>
                                                    </div>
                                                    <div class="spell-stat">
                                                        <span class="stat-label">Range:</span>
                                                        <span class="stat-value">{{ spell.range }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endif %}
                                </section>
                                {% else %}
                                <div class="empty-spells">
                                    <div class="empty-icon">üîÆ</div>
                                    <h3>No Spells Available</h3>
                                    <p>This character doesn't have access to spellcasting abilities.</p>
                                </div>
                                {% endif %}
                            </div>

                            <!-- Sidebar with Spell Recommendations -->
                            <div class="sheet-sidebar">
                                <section class="recommendations-section">
                                    <h3>‚ú® Spell Recommendations</h3>
                                    
                                    {% if recommendations.spells.recommendations %}
                                    <div class="recommendation-card">
                                        <h4>üîÆ Recommended Spells</h4>
                                        <p class="recommendation-reason">{{ recommendations.spells.reason }}</p>
                                        <div class="recommendation-list">
                                            {% for spell in recommendations.spells.recommendations %}
                                            <span class="recommendation-item">{{ spell }}</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endif %}

                                    <!-- Spellcasting Tips -->
                                    <div class="recommendation-card">
                                        <h4>üí° Spellcasting Tips</h4>
                                        <div class="tips-list">
                                            <p class="tip-item">üéØ Use your highest spellcasting modifier for attack rolls</p>
                                            <p class="tip-item">üõ°Ô∏è Save DC = 8 + proficiency bonus + spellcasting modifier</p>
                                            <p class="tip-item">‚ö° Cantrips scale with character level, not class level</p>
                                            <p class="tip-item">üìö Consider spells that complement your party's abilities</p>
                                        </div>
                                    </div>

                                    <!-- Spell School Distribution -->
                                    {% if character.cantrips or character.spells_known or character.spells %}
                                    <div class="recommendation-card">
                                        <h4>üéì Spell School Analysis</h4>
                                        <div class="school-analysis">
                                            <p class="analysis-text">Your spell selection shows a preference for utility and versatility.</p>
                                            <div class="school-tags">
                                                <span class="school-tag evocation">Evocation</span>
                                                <span class="school-tag abjuration">Abjuration</span>
                                                <span class="school-tag transmutation">Transmutation</span>
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                </section>
                            </div>
                        </div>
                    </div>

                    <!-- Combat Tab -->
                    <div class="tab-pane" id="combat-tab">
                        <div class="sheet-content">
                            <div class="sheet-main">
                                <!-- Combat Statistics Section -->
                                <section class="combat-section">
                                    <h3>‚öîÔ∏è Combat Statistics</h3>
                                    
                                    <!-- Combat Stats Grid -->
                                    <div class="combat-stats-grid">
                                        <div class="combat-stat-card">
                                            <div class="stat-icon">üõ°Ô∏è</div>
                                            <div class="stat-info">
                                                <div class="stat-label">Armor Class</div>
                                                <div class="stat-value">{{ character.get_armor_class() }}</div>
                                            </div>
                                        </div>
                                        
                                        <div class="combat-stat-card">
                                            <div class="stat-icon">üéØ</div>
                                            <div class="stat-info">
                                                <div class="stat-label">Initiative</div>
                                                <div class="stat-value">
                                                    {% set modifier = character.get_initiative() %}
                                                    {% if modifier >= 0 %}+{% endif %}{{ modifier }}
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="combat-stat-card">
                                            <div class="stat-icon">‚ö°</div>
                                            <div class="stat-info">
                                                <div class="stat-label">Speed</div>
                                                <div class="stat-value">{{ character.get_speed() }} ft</div>
                                            </div>
                                        </div>
                                        
                                        <div class="combat-stat-card">
                                            <div class="stat-icon">üé≤</div>
                                            <div class="stat-info">
                                                <div class="stat-label">Proficiency Bonus</div>
                                                <div class="stat-value">+{{ character.get_proficiency_bonus() }}</div>
                                            </div>
                                        </div>
                                    </div>
                                </section>

                                <!-- Hit Points Section -->
                                            <section class="hit-points-section">
                <h3>‚ù§Ô∏è Hit Points</h3>
                <div class="hit-points-editor">
                    <div class="hp-grid">
                        <div class="hp-item">
                            <label>Hit Point Maximum</label>
                            <input type="number" id="hp-maximum" class="hp-input" 
                                   value="{{ character.hit_point_maximum or character.get_hit_points() }}" min="1">
                        </div>
                        <div class="hp-item">
                            <label>Current Hit Points</label>
                            <input type="number" id="hp-current" class="hp-input" 
                                   value="{{ character.current_hit_points or character.get_hit_points() }}" min="0">
                        </div>
                        <div class="hp-item">
                            <label>Temporary Hit Points</label>
                            <input type="number" id="hp-temporary" class="hp-input" 
                                   value="{{ character.temporary_hit_points }}" min="0">
                        </div>
                        <div class="hp-item">
                            <label>Hit Dice</label>
                            <span class="hp-display">{{ character.hit_dice or character.get_hit_dice() }}</span>
                        </div>
                    </div>
                    
                    <!-- HP Visual Bar -->
                    <div class="hp-visual-bar">
                        <div class="hp-bar-container">
                            <div class="hp-bar-maximum" id="hp-bar-maximum"></div>
                            <div class="hp-bar-current" id="hp-bar-current"></div>
                            <div class="hp-bar-temporary" id="hp-bar-temporary"></div>
                        </div>
                        <div class="hp-bar-labels">
                            <span class="hp-label-maximum">Maximum</span>
                            <span class="hp-label-current">Current</span>
                            <span class="hp-label-temporary">Temporary</span>
                        </div>
                    </div>
                    
                    <button id="save-hp-btn" class="btn btn-success">üíæ Save HP</button>
                </div>
            </section>

                                <!-- Passive Skills Section -->
                                <section class="passive-skills-section">
                                    <h3>üëÅÔ∏è Passive Skills</h3>
                                    <div class="passive-skills-grid">
                                        <div class="passive-skill-item">
                                            <div class="skill-icon">üëÅÔ∏è</div>
                                            <div class="skill-info">
                                                <div class="skill-label">Passive Perception</div>
                                                <div class="skill-value">{{ character.get_passive_perception() }}</div>
                                            </div>
                                        </div>
                                        <div class="passive-skill-item">
                                            <div class="skill-icon">üîç</div>
                                            <div class="skill-info">
                                                <div class="skill-label">Passive Investigation</div>
                                                <div class="skill-value">{{ character.get_passive_investigation() }}</div>
                                            </div>
                                        </div>
                                        <div class="passive-skill-item">
                                            <div class="skill-icon">üß†</div>
                                            <div class="skill-info">
                                                <div class="skill-label">Passive Insight</div>
                                                <div class="skill-value">{{ character.get_passive_insight() }}</div>
                                            </div>
                                        </div>
                                    </div>
                                </section>

                                <!-- Saving Throws -->
                                <section class="saving-throws-section">
                                    <h3>üõ°Ô∏è Saving Throws</h3>
                                    <div class="saving-throws-grid">
                                        {% for attr in ['Strength', 'Dexterity', 'Constitution', 'Intelligence', 'Wisdom', 'Charisma'] %}
                                        <div class="saving-throw-item">
                                            <span class="throw-name">{{ attr[:3] }}</span>
                                            <span class="throw-bonus">
                                                {% set bonus = character.get_saving_throw_bonus(attr) %}
                                                {% if bonus >= 0 %}+{% endif %}{{ bonus }}
                                            </span>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </section>
                            </div>

                            <!-- Sidebar with Combat Recommendations -->
                            <div class="sheet-sidebar">
                                <section class="recommendations-section">
                                    <h3>‚öîÔ∏è Combat Strategy</h3>
                                    
                                    <div class="recommendation-card">
                                        <h4>üéØ Combat Role</h4>
                                        <p class="recommendation-title">{{ character.get_combat_role() }}</p>
                                        <p class="recommendation-reason">Based on your class and abilities, you excel in this combat role.</p>
                                    </div>

                                    <div class="recommendation-card">
                                        <h4>üí° Tactical Tips</h4>
                                        <div class="tips-list">
                                            <p class="tip-item">üéØ Position yourself strategically for maximum effectiveness</p>
                                            <p class="tip-item">üõ°Ô∏è Use cover and terrain to your advantage</p>
                                            <p class="tip-item">‚ö° Coordinate with your party for optimal tactics</p>
                                            <p class="tip-item">üìö Know your spell ranges and areas of effect</p>
                                        </div>
                                    </div>
                                </section>
                            </div>
                                            </div>
                </div>

                    <!-- Inventory Tab -->
                    <div class="tab-pane" id="inventory-tab">
                        <div class="sheet-content">
                            <div class="sheet-main">
                                <!-- Equipment Packs Section -->
                                <section class="packs-section">
                                    <h3>üì¶ Equipment Packs</h3>
                                    <div class="packs-grid">
                                        <button class="pack-btn" data-pack="Burglar's Pack">
                                            <div class="pack-icon">ü¶π</div>
                                            <div class="pack-name">Burglar's Pack</div>
                                            <div class="pack-desc">Perfect for rogues and stealthy characters</div>
                                        </button>
                                        <button class="pack-btn" data-pack="Diplomat's Pack">
                                            <div class="pack-icon">ü§ù</div>
                                            <div class="pack-name">Diplomat's Pack</div>
                                            <div class="pack-desc">Ideal for characters focused on social interaction</div>
                                        </button>
                                        <button class="pack-btn" data-pack="Dungeoneer's Pack">
                                            <div class="pack-icon">üè∞</div>
                                            <div class="pack-name">Dungeoneer's Pack</div>
                                            <div class="pack-desc">Essential for exploring dungeons and caves</div>
                                        </button>
                                        <button class="pack-btn" data-pack="Entertainer's Pack">
                                            <div class="pack-icon">üé≠</div>
                                            <div class="pack-name">Entertainer's Pack</div>
                                            <div class="pack-desc">Perfect for bards and performers</div>
                                        </button>
                                        <button class="pack-btn" data-pack="Explorer's Pack">
                                            <div class="pack-icon">üó∫Ô∏è</div>
                                            <div class="pack-name">Explorer's Pack</div>
                                            <div class="pack-desc">Great for wilderness exploration and survival</div>
                                        </button>
                                        <button class="pack-btn" data-pack="Priest's Pack">
                                            <div class="pack-icon">‚õ™</div>
                                            <div class="pack-name">Priest's Pack</div>
                                            <div class="pack-desc">Ideal for clerics and religious characters</div>
                                        </button>
                                        <button class="pack-btn" data-pack="Scholar's Pack">
                                            <div class="pack-icon">üìö</div>
                                            <div class="pack-name">Scholar's Pack</div>
                                            <div class="pack-desc">Perfect for wizards and knowledge seekers</div>
                                        </button>
                                    </div>
                                    <div class="pack-status" id="pack-status"></div>
                                </section>

                                <!-- Currency Section -->
                                <section class="currency-section">
                                    <h3>üí∞ Currency</h3>
                                    <div class="currency-grid">
                                        <div class="currency-item">
                                            <label for="cp-amount">Copper (cp)</label>
                                            <input type="number" id="cp-amount" class="currency-input" 
                                                   value="{{ character.currency.get('cp', 0) }}" min="0">
                                        </div>
                                        <div class="currency-item">
                                            <label for="sp-amount">Silver (sp)</label>
                                            <input type="number" id="sp-amount" class="currency-input" 
                                                   value="{{ character.currency.get('sp', 0) }}" min="0">
                                        </div>
                                        <div class="currency-item">
                                            <label for="ep-amount">Electrum (ep)</label>
                                            <input type="number" id="ep-amount" class="currency-input" 
                                                   value="{{ character.currency.get('ep', 0) }}" min="0">
                                        </div>
                                        <div class="currency-item">
                                            <label for="gp-amount">Gold (gp)</label>
                                            <input type="number" id="gp-amount" class="currency-input" 
                                                   value="{{ character.currency.get('gp', 0) }}" min="0">
                                        </div>
                                        <div class="currency-item">
                                            <label for="pp-amount">Platinum (pp)</label>
                                            <input type="number" id="pp-amount" class="currency-input" 
                                                   value="{{ character.currency.get('pp', 0) }}" min="0">
                                        </div>
                                    </div>
                                    <div class="currency-total">
                                        <strong>Total Value:</strong> <span id="currency-total">{{ character.format_currency() }}</span>
                                    </div>
                                </section>

                                <!-- Items Section -->
                                <section class="items-section">
                                    <h3>üéí Items & Equipment</h3>
                                    <div class="items-input-container">
                                        <input type="text" id="items-input" 
                                               placeholder="Type item name and press Enter, Space, or Comma to add..."
                                               class="items-input">
                                        <div id="items-display" class="items-display">
                                            {% for item in character.items %}
                                            <span class="item-tag" data-item="{{ item }}">
                                                <div class="item-content">
                                                    <span class="item-name">{{ item }}</span>
                                                    <span class="item-weight" data-item="{{ item }}">
                                                        {{ character.get_item_weight(item) }} lbs
                                                    </span>
                                                </div>
                                                <button type="button" class="item-edit-weight" onclick="editItemWeight('{{ item }}')" title="Edit weight">‚öñÔ∏è</button>
                                                <button type="button" class="item-remove" onclick="removeItem(this)">√ó</button>
                                            </span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="items-actions">
                                        <button id="clear-all-items-btn" class="btn btn-danger">
                                            üóëÔ∏è Clear All Items
                                        </button>
                                    </div>
                                    <div class="items-help">
                                        üí° Add equipment, weapons, armor, tools, and other items your character carries. Click ‚öñÔ∏è to edit item weight.
                                    </div>
                                </section>

                                <!-- Weight & Capacity Section -->
                                <section class="weight-section">
                                    <h3>‚öñÔ∏è Weight & Capacity</h3>
                                    <div class="weight-grid">
                                        <div class="weight-item">
                                            <div class="weight-label">Carrying Capacity</div>
                                            <div class="weight-value">{{ character.get_carrying_capacity() }} lbs</div>
                                            <div class="weight-desc">Based on Strength (15 √ó STR)</div>
                                        </div>
                                        <div class="weight-item">
                                            <div class="weight-label">Push/Drag/Lift</div>
                                            <div class="weight-value">{{ character.get_push_drag_lift() }} lbs</div>
                                            <div class="weight-desc">Maximum weight (30 √ó STR)</div>
                                        </div>
                                        <div class="weight-item">
                                            <div class="weight-label">Current Weight</div>
                                            <div class="weight-value" id="current-weight">{{ character.get_estimated_weight() }} lbs</div>
                                            <div class="weight-desc">Estimated from items</div>
                                        </div>
                                    </div>
                                    <div class="weight-status" id="weight-status">
                                        {% set capacity = character.get_carrying_capacity() %}
                                        {% set weight = character.get_estimated_weight() %}
                                        {% if weight > capacity %}
                                            <span class="weight-warning">‚ö†Ô∏è Overloaded! Reduce weight to avoid penalties.</span>
                                        {% elif weight > capacity * 0.8 %}
                                            <span class="weight-caution">‚ö° Heavy load - movement may be affected.</span>
                                        {% else %}
                                            <span class="weight-ok">‚úÖ Weight is manageable.</span>
                                        {% endif %}
                                    </div>
                                </section>

                                <!-- Save Button -->
                                <div class="inventory-actions">
                                    <button id="save-inventory-btn" class="btn btn-success">
                                        üíæ Save Inventory
                                    </button>
                                    <div id="inventory-save-status" class="save-status"></div>
                                </div>
                            </div>

                            <!-- Sidebar with Inventory Tips -->
                            <div class="sheet-sidebar">
                                <section class="recommendations-section">
                                    <h3>üéí Inventory Management</h3>
                                    
                                    <div class="recommendation-card">
                                        <h4>üí∞ Currency Tips</h4>
                                        <div class="tips-list">
                                            <p class="tip-item">üí° 1 Gold = 10 Silver = 100 Copper</p>
                                            <p class="tip-item">üí° 1 Platinum = 10 Gold = 1000 Copper</p>
                                            <p class="tip-item">üí° Keep some copper for small purchases</p>
                                            <p class="tip-item">üí° Gold is the standard for most transactions</p>
                                        </div>
                                    </div>

                                    <div class="recommendation-card">
                                        <h4>‚öñÔ∏è Weight Management</h4>
                                        <div class="tips-list">
                                            <p class="tip-item">üéØ Stay under carrying capacity for full movement</p>
                                            <p class="tip-item">‚ö° Heavy loads reduce movement speed</p>
                                            <p class="tip-item">üõ°Ô∏è Consider using a mount or pack animal</p>
                                            <p class="tip-item">üì¶ Use containers to organize your gear</p>
                                        </div>
                                    </div>

                                    <div class="recommendation-card">
                                        <h4>üéí Essential Items</h4>
                                        <div class="tips-list">
                                            <p class="tip-item">üõ°Ô∏è Armor and weapons for your class</p>
                                            <p class="tip-item">üèïÔ∏è Bedroll, rations, and waterskin</p>
                                            <p class="tip-item">üîß Tools and equipment for your skills</p>
                                            <p class="tip-item">üíä Healing potions and scrolls</p>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        </main>

        <!-- Spell Info Modal -->
        <div id="spell-modal" class="spell-info-modal" style="display: none;">
            <div class="spell-info-content">
                <div class="spell-info-header">
                    <h3 class="spell-info-title">
                        <span id="modal-spell-name"></span>
                        <span id="modal-spell-source" class="spell-source"></span>
                    </h3>
                    <button class="spell-info-close" onclick="closeSpellModal()">&times;</button>
                </div>
                <div class="spell-info-body">
                    <div class="spell-info-grid">
                        <div class="spell-info-item">
                            <strong>School</strong>
                            <span id="modal-spell-school"></span>
                        </div>
                        <div class="spell-info-item">
                            <strong>Casting Time</strong>
                            <span id="modal-spell-casting-time"></span>
                        </div>
                        <div class="spell-info-item">
                            <strong>Range</strong>
                            <span id="modal-spell-range"></span>
                        </div>
                        <div class="spell-info-item">
                            <strong>Components</strong>
                            <span id="modal-spell-components"></span>
                        </div>
                        <div class="spell-info-item">
                            <strong>Duration</strong>
                            <span id="modal-spell-duration"></span>
                        </div>
                    </div>
                    <div class="spell-info-description">
                        <strong>Description</strong>
                        <p id="modal-spell-description"></p>
                    </div>
                </div>
            </div>
        </div>

        <footer class="main-footer">
            <p>&copy; 2024 EchoSheet - Intelligent Character Sheets for D&D</p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        // Tab functionality
        document.addEventListener('DOMContentLoaded', function() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabPanes = document.querySelectorAll('.tab-pane');

            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Remove active class from all buttons and panes
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabPanes.forEach(p => p.classList.remove('active'));
                    
                    // Add active class to clicked button and corresponding pane
                    this.classList.add('active');
                    document.getElementById(targetTab + '-tab').classList.add('active');
                });
            });
        });

        // Spell modal functionality
        function showSpellInfo(spellName) {
            // Fetch spell data from the server
            fetch(`/api/spell/${encodeURIComponent(spellName)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const spell = data.spell;
                        document.getElementById('modal-spell-name').textContent = spell.name;
                        document.getElementById('modal-spell-school').textContent = spell.school;
                        document.getElementById('modal-spell-casting-time').textContent = spell.casting_time;
                        document.getElementById('modal-spell-range').textContent = spell.range;
                        document.getElementById('modal-spell-components').textContent = spell.components.join(', ');
                        document.getElementById('modal-spell-duration').textContent = spell.duration;
                        document.getElementById('modal-spell-description').textContent = spell.description;
                        document.getElementById('modal-spell-source').textContent = spell.source;
                        document.getElementById('modal-spell-source').className = `spell-source ${spell.source.toLowerCase()}`;
                        document.getElementById('spell-modal').style.display = 'flex';
                    } else {
                        alert('Spell information not found');
                    }
                })
                .catch(error => {
                    console.error('Error fetching spell info:', error);
                    alert('Error loading spell information');
                });
        }

        function closeSpellModal() {
            document.getElementById('spell-modal').style.display = 'none';
        }

        // Close modal when clicking outside
        document.getElementById('spell-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSpellModal();
            }
        });
    </script>
</body>
</html> 